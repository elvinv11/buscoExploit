#!/bin/bash
#
#VenCERT-SUSCERTE
#Autor: Elvin Vargas
#Especialista en Seguridad Logica
#Titulo: Script de Automatización para la Busqueda de Vulnerabilidades en Distribuciones GNU/Linux
#Fecha: Mayo del 2022
#
#
fichero_dpkg=$1
fichero=${fichero_dpkg:?'Debe suministrar un archivo con la salida del comando dpkg -l'}
boldon=`tput smso`
boldoff=`tput rmso`
function parch
    {
    while IFS= read -r l
        do
        l=${l#??}
        l=${l%amd64*}
        l=${l%-[0-9]*}
        l=${l% all*}
        l=${l%+*}
        echo $l >> paquetesInstalados
        done
    }
parch < "$fichero"

if sed -i '1,5d' paquetesInstalados
    then
    while 	IFS= read -r a
        do
        echo "$a" >> resultado.txt
        searchsploit $a >> resultado.txt
        echo "Trabajando en ${a}. Por favor espere"
        done < paquetesInstalados
    fi
if echo -e "\nBusqueda Finalizada. Los resultados se mostrarán en el archivo ${boldon}resultado.txt${boldoff} donde encontrarás los posibles problemas de seguridad" && sed -i '/Exploits: No Results/d' resultado.txt && sed -i '/Shellcodes: No Results/d' resultado.txt && rm paquetesInstalados
    then
    echo "Estimado usuario, el resultado lo encontrara en la carpeta donde ejecuto el script"
fi




